-- ==// Startup screen //==

-- local fn = vim.fn
local fortune = require("alpha.fortune")
local theta_theme = require("alpha.themes.theta")
local dashboard_theme = require("alpha.themes.dashboard")

-- Button ref:
-- local bottom_buttons =  {
--     type = 'group',
--     val = {
--         {
--             type = "button",
--             val = "‚¨ÜÔ∏è Update Plugins",
--             on_press = function()
--                 require("packer").sync()
--             end,
--
--             -- optional
--             opts = {
--                 position = "center",
--                 shortcut = ":PackerSync",
--                 align_shortcut = "right",
--                 hl_shortcut = "Keyword",
--                 cursor = 7,
--                 width = 50,
--             }
--         }
--     }
-- }

-- https://github.com/MaximilianLloyd/ascii.nvim
local headers_art = {
	{
		[[ ‚£ê‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚†Ö‚¢ó‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚†ï‚†ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï]],
		[[‚¢ê‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚£ï‚¢ï‚¢ï‚†ï‚†Å‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚†Ö‚°Ñ‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï]],
		[[‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚†Ö‚¢ó‚¢ï‚†ï‚£†‚†Ñ‚£ó‚¢ï‚¢ï‚†ï‚¢ï‚¢ï‚¢ï‚†ï‚¢†‚£ø‚†ê‚¢ï‚¢ï‚¢ï‚†ë‚¢ï‚¢ï‚†µ‚¢ï]],
		[[‚¢ï‚¢ï‚¢ï‚¢ï‚†Å‚¢ú‚†ï‚¢Å‚£¥‚£ø‚°á‚¢ì‚¢ï‚¢µ‚¢ê‚¢ï‚¢ï‚†ï‚¢Å‚£æ‚¢ø‚£ß‚†ë‚¢ï‚¢ï‚†Ñ‚¢ë‚¢ï‚†Ö‚¢ï]],
		[[‚¢ï‚¢ï‚†µ‚¢Å‚†î‚¢Å‚£§‚£§‚£∂‚£∂‚£∂‚°ê‚£ï‚¢Ω‚†ê‚¢ï‚†ï‚£°‚£æ‚£∂‚£∂‚£∂‚£§‚°Å‚¢ì‚¢ï‚†Ñ‚¢ë‚¢Ö‚¢ë]],
		[[‚†ç‚£ß‚†Ñ‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£î‚¢ï‚¢Ñ‚¢°‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£¶‚°ë‚¢ï‚¢§‚†±‚¢ê]],
		[[‚¢†‚¢ï‚†Ö‚£æ‚£ø‚†ã‚¢ø‚£ø‚£ø‚£ø‚†â‚£ø‚£ø‚£∑‚£¶‚£∂‚£Ω‚£ø‚£ø‚†à‚£ø‚£ø‚£ø‚£ø‚†è‚¢π‚£∑‚£∑‚°Ö‚¢ê]],
		[[‚£î‚¢ï‚¢•‚¢ª‚£ø‚°Ä‚†à‚†õ‚†õ‚†Å‚¢†‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚†à‚†õ‚†õ‚†Å‚†Ñ‚£º‚£ø‚£ø‚°á‚¢î]],
		[[‚¢ï‚¢ï‚¢Ω‚¢∏‚¢ü‚¢ü‚¢ñ‚¢ñ‚¢§‚£∂‚°ü‚¢ª‚£ø‚°ø‚†ª‚£ø‚£ø‚°ü‚¢Ä‚£ø‚£¶‚¢§‚¢§‚¢î‚¢û‚¢ø‚¢ø‚£ø‚†Å‚¢ï]],
		[[‚¢ï‚¢ï‚†Ö‚£ê‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚£ø‚£ø‚°Ñ‚†õ‚¢Ä‚£¶‚†à‚†õ‚¢Å‚£º‚£ø‚¢ó‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚°è‚£ò‚¢ï]],
		[[‚¢ï‚¢ï‚†Ö‚¢ì‚£ï‚£ï‚£ï‚£ï‚£µ‚£ø‚£ø‚£ø‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£ï‚¢ï‚¢ï‚¢ï‚¢ï‚°µ‚¢Ä‚¢ï‚¢ï]],
		[[‚¢ë‚¢ï‚†É‚°à‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢É‚¢ï‚¢ï‚¢ï]],
		[[‚£Ü‚¢ï‚†Ñ‚¢±‚£Ñ‚†õ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚¢Å‚¢ï‚¢ï‚†ï‚¢Å]],
		[[‚£ø‚£¶‚°Ä‚£ø‚£ø‚£∑‚£∂‚£¨‚£ç‚£õ‚£õ‚£õ‚°õ‚†ø‚†ø‚†ø‚†õ‚†õ‚¢õ‚£õ‚£â‚£≠‚£§‚£Ç‚¢ú‚†ï‚¢ë‚£°‚£¥‚£ø]],
	},
	{
		[[‚£á‚£ø‚†ò‚£ø‚£ø‚£ø‚°ø‚°ø‚£ü‚£ü‚¢ü‚¢ü‚¢ù‚†µ‚°ù‚£ø‚°ø‚¢Ç‚£º‚£ø‚£∑‚£å‚†©‚°´‚°ª‚£ù‚†π‚¢ø‚£ø‚£∑]],
		[[‚°Ü‚£ø‚£Ü‚†±‚£ù‚°µ‚£ù‚¢Ö‚†ô‚£ø‚¢ï‚¢ï‚¢ï‚¢ï‚¢ù‚£•‚¢í‚†Ö‚£ø‚£ø‚£ø‚°ø‚£≥‚£å‚†™‚°™‚£°‚¢ë‚¢ù‚£á]],
		[[‚°Ü‚£ø‚£ø‚£¶‚†π‚£≥‚£≥‚£ï‚¢Ö‚†à‚¢ó‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚¢à‚¢Ü‚†ü‚†ã‚†â‚†Å‚†â‚†â‚†Å‚†à‚†º‚¢ê‚¢ï‚¢Ω]],
		[[‚°ó‚¢∞‚£∂‚£∂‚£¶‚£ù‚¢ù‚¢ï‚¢ï‚†Ö‚°Ü‚¢ï‚¢ï‚¢ï‚¢ï‚¢ï‚£¥‚†è‚£†‚°∂‚†õ‚°â‚°â‚°õ‚¢∂‚£¶‚°Ä‚†ê‚£ï‚¢ï]],
		[[‚°ù‚°Ñ‚¢ª‚¢ü‚£ø‚£ø‚£∑‚£ï‚£ï‚£Ö‚£ø‚£î‚£ï‚£µ‚£µ‚£ø‚£ø‚¢†‚£ø‚¢†‚£Æ‚°à‚£å‚†®‚†Ö‚†π‚£∑‚°Ä‚¢±‚¢ï]],
		[[‚°ù‚°µ‚†ü‚†à‚¢Ä‚£Ä‚£Ä‚°Ä‚†â‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£º‚£ø‚¢à‚°ã‚†¥‚¢ø‚°ü‚£°‚°á‚£ø‚°á‚°Ä‚¢ï]],
		[[‚°ù‚†Å‚£†‚£æ‚†ü‚°â‚°â‚°â‚†ª‚£¶‚£ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚†∏‚£ø‚£¶‚£•‚£ø‚°á‚°ø‚£∞‚¢ó‚¢Ñ]],
		[[‚†Å‚¢∞‚£ø‚°è‚£¥‚£å‚†à‚£å‚†°‚†à‚¢ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£¨‚£â‚£â‚£Å‚£Ñ‚¢ñ‚¢ï‚¢ï‚¢ï]],
		[[‚°Ä‚¢ª‚£ø‚°á‚¢ô‚†Å‚†¥‚¢ø‚°ü‚£°‚°Ü‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£µ‚£µ‚£ø]],
		[[‚°ª‚£Ñ‚£ª‚£ø‚£å‚†ò‚¢ø‚£∑‚£•‚£ø‚†á‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†õ‚†ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø]],
		[[‚£∑‚¢Ñ‚†ª‚£ø‚£ü‚†ø‚†¶‚†ç‚†â‚£°‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∏‚£ø‚£¶‚†ô‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü]],
		[[‚°ï‚°ë‚£ë‚£à‚£ª‚¢ó‚¢ü‚¢û‚¢ù‚£ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†∏‚£ø‚†ø‚†É‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Å‚£†]],
		[[‚°ù‚°µ‚°à‚¢ü‚¢ï‚¢ï‚¢ï‚¢ï‚£µ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∂‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†ã‚£Ä‚£à‚†ô]],
		[[‚°ù‚°µ‚°ï‚°Ä‚†ë‚†≥‚†ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†õ‚¢â‚°†‚°≤‚°´‚°™‚°™‚°£]],
	},
	-- Very rare special case...
	{
		[[     ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°¥‚†û‚†â‚¢â‚£≠‚£ø‚£ø‚†ø‚£≥‚£§‚†¥‚†ñ‚†õ‚£õ‚£ø‚£ø‚°∑‚†ñ‚£∂‚£§‚°Ä‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚†Å‚¢Ä‚£∂‚¢ª‚°ü‚†ø‚†ã‚£¥‚†ø‚¢ª‚£ß‚°¥‚†ü‚†ã‚†ø‚†õ‚††‚†æ‚¢õ‚£µ‚£ø‚†Ä‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚£º‚£ø‚°ø‚¢∂‚£Ñ‚†Ä‚¢Ä‚°á‚¢Ä‚°ø‚†Å‚†à‚†Ä‚†Ä‚£Ä‚£â‚£Ä‚†ò‚£ø‚†Ä‚†Ä‚£Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†õ‚°π‚†ã‚†Ä‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚£≠‚£§‚°à‚¢ë‚£º‚£ª‚£ø‚£ß‚°å‚†Å‚†Ä‚¢Ä‚£¥‚†ü‚†ã‚†â‚†â‚†õ‚£ø‚£¥‚†ü‚†ã‚†ô‚†ª‚£¶‚°∞‚£û‚†Å‚¢Ä‚£§‚£¶‚£§‚†Ä  ]],
		[[   ‚†Ä‚†Ä‚£∞‚¢´‚£æ‚†ã‚£Ω‚†ü‚†ë‚†õ‚¢†‚°ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ª‚°Ñ‚†Ä‚†Ä‚†Ä‚†ò‚£∑‚°à‚†ª‚£ç‚†§‚¢§‚£å‚£Ä  ]],
		[[   ‚¢Ä‚°û‚£°‚°å‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ø‚°Ä‚†Ä‚†Ä‚†Ä‚†∏‚£á‚†Ä‚¢æ‚£∑‚¢§‚£¨‚£â  ]],
		[[   ‚°û‚£º‚£ø‚£§‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†∏‚£ø‚£á‚†à‚†ª  ]],
		[[   ‚¢∞‚£ø‚°ø‚¢π‚†É‚†Ä‚£†‚†§‚†∂‚£º‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚£ø‚†õ‚°Ñ‚†Ä  ]],
		[[   ‚†à‚†â‚†Å‚†Ä‚†Ä‚†Ä‚°ü‚°Ä‚†Ä‚†à‚°ó‚†≤‚†∂‚†¶‚¢§‚£§‚£§‚£Ñ‚£Ä‚£Ä‚£∏‚£ß‚£§‚£§‚†§‚†§‚£ø‚£Ä‚°Ä‚†â‚£º‚°á‚†Ä  ]],
		[[   ‚£ø‚£¥‚£¥‚°Ü‚†Ä‚†Ä‚†ª‚£Ñ‚†Ä‚†Ä‚†°‚†Ä‚†Ä‚†Ä‚†à‚†õ‚†ã‚†Ä‚†Ä‚†Ä‚°à‚†Ä‚†ª‚†ü‚†Ä‚¢Ä‚†ã‚†â‚†ô‚¢∑‚°ø‚°á‚†Ä  ]],
		[[   ‚£ª‚°ø‚†è‚†Å‚†Ä‚†Ä‚¢†‚°ü‚†Ä‚†Ä‚†Ä‚†£‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†à‚†Ä‚¢Ä‚£Ä‚°æ‚£¥‚†É‚†Ä  ]],
		[[   ‚¢ø‚†õ‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†¢‚†Ñ‚£Ä‚††‚†º‚£Å‚†Ä‚°±‚†§‚†§‚†ê‚†Å‚†Ä‚†Ä‚£∏‚†ã‚¢ª‚°ü‚†Ä‚†Ä  ]],
		[[   ‚†à‚¢ß‚£Ä‚£§‚£∂‚°Ñ‚†ò‚£Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£§‚†ñ‚†õ‚†ª‚£Ñ‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°æ‚†ã‚¢Ä‚°û‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚†Ä‚†Ä‚†ª‚£ø‚£ø‚°á‚†Ä‚†à‚†ì‚¢¶‚£§‚£§‚£§‚°§‚†û‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†õ‚†í‚†ö‚¢©‚°Ö‚£†‚°¥‚†ã‚†Ä‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚†Ä‚†Ä‚†Ä‚†à‚†ª‚¢ß‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ê‚£ª‚†ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä  ]],
		[[   ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†ì‚†∂‚£§‚£Ñ‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£†‚°¥‚†ñ‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä  ]],
	},
	-- {
	--     [[ /\_/\ ]],
	--     [[( o.o )]],
	--     [[ > ^ < ]]
	-- }
}

-- local separator = {
--     type = "text",
--     val = "---------",
--     opts = {
--         position = "center",
--         hl = "Type",
--     },
-- }

math.randomseed(os.time())

local highlight = "Type"
local header_selection = math.random(1, #headers_art)
if header_selection == #headers_art then
	header_selection = math.random(1, #headers_art)
	if header_selection == #headers_art then
		highlight = "Keyword"
	end
end

local header = {
	type = "text",
	val = headers_art[header_selection],
	opts = {
		position = "center",
		hl = highlight,
	},
}

local top_buttons = {
	type = "group",
	val = {
		dashboard_theme.button("e", "üìÑ New file", ":ene <BAR> startinsert <CR>"),
		dashboard_theme.button("<Leader>P", "üìÇ Sessions", ":Telescope projections <CR>"),
		{
			type = "group",
			val = {
				{
					type = "button",
					val = "‚¨ÜÔ∏è Update Plugins",
					on_press = function()
						require("packer").sync()
					end,

					-- optional
					opts = {
						position = "center",
						shortcut = ":PackerSync",
						align_shortcut = "right",
						hl_shortcut = "Keyword",
						cursor = 7,
						width = 50,
					},
				},
			},
		},
	},
}

local buny = {
	[[]], -- for some reason - first line highlighted bad otherwise
	[[------------------------------------------------------]],
	[[------------------------------------------------------]],
	[[(\__/) ||     ]],
	[[(‚Ä¢„ÖÖ‚Ä¢) ||     ]],
	[[/   „Å•    ]],
}

local new_fortune = fortune()

-- TODO Garfield only on mondays lmao

-- See if it has a "- Author Name"
if string.match(new_fortune[#new_fortune], "%s%-%s?%w") ~= nil then
	local author_name = table.remove(new_fortune)

	for i, text in ipairs(new_fortune) do
		table.insert(buny, 2 + i, text)
	end

	-- Make the bunny the author
	local bottom_bunny = table.remove(buny)
	local trimmed_author = author_name:gsub("^%s*(.-)%s*$", "%1")
	table.insert(buny, bottom_bunny .. trimmed_author)
else
	for i, v in ipairs(new_fortune) do
		table.insert(buny, 2 + i, v)
	end
end

-- TODO: Auto-calcualte based on header and center
-- local marginTopPercent = 0.3
-- local headerPadding = fn.max({2, fn.floor(fn.winheight(0) * marginTopPercent) })

local config = {
	layout = {
		-- { type = 'padding', val = headerPadding },
		{ type = "padding", val = 2 },
		header,
		{ type = "padding", val = 4 },
		top_buttons,
		-- separator,
		-- bottom_buttons,
		{ type = "padding", val = 4 },
		{
			type = "group",
			val = {
				{
					type = "text",
					val = "Recent files",
					opts = {
						hl = "SpecialComment",
						shrink_margin = false,
						position = "center",
					},
				},
				{ type = "padding", val = 1 },
				{
					type = "group",
					val = function()
						return { theta_theme.mru(0, vim.fn.getcwd()) }
					end,
					opts = { shrink_margin = false },
				},
			},
		},
		{ type = "padding", val = 4 },
		{
			type = "text",
			val = buny,
			opts = {
				position = "center",
				hl = "SplashComment",
			},
		},
	},
	opts = {
		margin = 100,
		autostart = true,
	},
	setup = function()
		-- Just to remove the italics, so that the bunny holds a straight sign
		vim.cmd(":highlight SplashComment guifg=gray")
	end,
}

-- require("alpha").setup(config)
